<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Kernel | Troglobit]]></title>
  <link href="http://troglobit.github.io/blog/categories/kernel/atom.xml" rel="self"/>
  <link href="http://troglobit.github.io/"/>
  <updated>2015-09-09T22:25:54+02:00</updated>
  <id>http://troglobit.github.io/</id>
  <author>
    <name><![CDATA[Joachim Nilsson]]></name>
    <email><![CDATA[troglobit@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[HowTo: Add Multicast Routing to FreeBSD Kernel]]></title>
    <link href="http://troglobit.github.io/blog/2014/09/23/howto-add-multicast-routing-support-to-the-freebsd-kernel/"/>
    <updated>2014-09-23T01:55:19+02:00</updated>
    <id>http://troglobit.github.io/blog/2014/09/23/howto-add-multicast-routing-support-to-the-freebsd-kernel</id>
    <content type="html"><![CDATA[<p>This is a very short blog post, mostly intended as a reminder to myself.
Basically, there are two methods of adding multicast routing support to
the FreeBSD kernel:</p>

<ol>
<li>Rebuild the kernel with <code>options MROUTING</code></li>
<li>Load the kernel module: <code>kldload ip_mroute</code></li>
</ol>


<p>The kernel rebuild assumes the <code>src.txz</code> set was installed previously.</p>

<pre><code>cd /usr/src
cd sys/amd64/conf
cat GENERIC | sed 's/GENERIC$/MULTICAST/' &gt; MULTICAST
echo 'options   MROUTING         # Multicast routing' &gt;&gt; MULTICAST
echo 'options   PIM              # Enable for pimd'   &gt;&gt; MULTICAST
cd -
make kernel KERNCONF=MULTICAST
reboot
</code></pre>

<p>That&rsquo;s it.  Remember to make sure your Qemu VM has enough RAM or it
will probably page fault on you.  I use 1,0 GB RAM.</p>

<p>The other option, to load the ready made module, is likely better.  But
you want it to load at boot.  So add this to <code>/boot/loader.conf</code>:</p>

<pre><code>ip_mroute_load="yes"
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HowTo: Building Debian/Ubuntu Kernels]]></title>
    <link href="http://troglobit.github.io/blog/2007/02/03/building-debian-slash-ubuntu-kernels/"/>
    <updated>2007-02-03T10:00:45+01:00</updated>
    <id>http://troglobit.github.io/blog/2007/02/03/building-debian-slash-ubuntu-kernels</id>
    <content type="html"><![CDATA[<p>I have been over this topic so many times now, strangely enough I&rsquo;ve
managed to make things more complicated than they need to be.  It&rsquo;s
really this simple:</p>

<pre><code>$ wget ftp://ftp.sunet.se/pub/Linux/kernels/v2.6/linux-2.6.19.2.tar.bz2
$ tar xfj linux-2.6.19.2.tar.bz2
$ cd linux-2.6.19.2/
$ zcat /proc/config.gz &gt;.config
$ make menuconfig
[Tweak to your hearts desire]
$ fakeroot make-kpkg --initrd kernel_image
$ dpkg -i ../linux-image-2.6.19.2_2.6.19.2-10.00.Custom_i386.deb
[DONE!]
</code></pre>

<p>You may, of course, need to tweak the file <code>/etc/kernel-pkg.conf</code>, but
there are man pages for that.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Make-kpkg and Dirty Modules]]></title>
    <link href="http://troglobit.github.io/blog/2006/07/17/make-kpkg-and-dirty-modules/"/>
    <updated>2006-07-17T22:10:24+02:00</updated>
    <id>http://troglobit.github.io/blog/2006/07/17/make-kpkg-and-dirty-modules</id>
    <content type="html"><![CDATA[<p>Dammit, tonight I spent too many hours chasing down a &ldquo;feature&rdquo; in the
Debian kernel build process or the Linux-2.6 kernel.  I haven&rsquo;t yet
deciced who to blame ;-)</p>

<p>Here goes: when you build the latest Linux 2.6 kernel, checked out from
the git repository, with <code>make-kpkg</code> you should make sure to uncheck the
<code>CONFIG_LOCALVERSION_AUTO</code> option in the kernel config before hand.
It&rsquo;s under &ldquo;General setup&rdquo; &rarr; &ldquo;Automatically append version
information &hellip;&rdquo;.  If you don&rsquo;t disable it, then your <code>utsrelease.h</code>
will contain some annoying extra git version string and your modules
directory will look something like this: <code>/lib/modules/2.6.18-dirty</code></p>

<p>All this due to the <code>LOCALVERSION</code> config, your git checkout, and the
tiny little fact that <code>make-kpkg</code> modifies (moves away) the two files
<code>scripts/packages/{builddeb,Makefile}</code> which leads to the modification
of the checkout and the scripts/setlocalversion will tell this to the
top Makefile which in turn will create this whole mess.</p>

<p>Take my advice, untick the <code>CONFIG_LOCALVERSION_AUTO</code> option.  It&rsquo;s the
easiest one to get away with.</p>
]]></content>
  </entry>
  
</feed>
