<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Joachim Wiberg ">
<meta name="description" content="GRE tunnels are useful in many ways. This blog post shows how to set up multicast routing with pimd over a GRE tunnel. To achieve this we will also set up OSPF over GRE with Quagga, because PIM, unlike DVMRP (mrouted), require unicast routing rules to be established.
.----{ Intranet }----. / 192.168.1.0/24 \ / \ .10 / \.20 .--&amp;#39;---. .1 GRE Tunnel .2 .---`--. | |====================| | | R1 | 172.16.16.0/30 | R2 | | | | | &amp;#39;--.---&amp;#39; &amp;#39;------&amp;#39; | .1 | .1 | 10.0.1.0/24 | 10.0.2.0/24 | .2 | .2 .--&amp;#39;---. .--&amp;#39;---. | | | | | C1 | | C2 | | | | | &amp;#39;------&amp;#39; &amp;#39;------&amp;#39; In this post we are using the home WiFi network, 192.168.1.0/24, to hook up the GRE tunnel. It is just as easy to extend this to a big corporate Intranet with more routers between R1 and R2. As long as that IT department takes care of the unicast routing between R1 and R2 so that the GRE tunnel can be established.
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://troglobit.com/2016/07/05/multicast-routing-with-pim-sm-over-gre/" />


    <title>
        
            Multicast routing with PIM-SM over GRE :: Joachim Wiberg  — The Last Outpost
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://troglobit.com/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">


    
        <link rel="stylesheet" type="text/css" href="https://troglobit.com/css/extra.css">
    



    <link rel="apple-touch-icon" sizes="180x180" href="https://troglobit.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://troglobit.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://troglobit.com/favicon-16x16.png">
    <link rel="manifest" href="https://troglobit.com/site.webmanifest">
    <link rel="mask-icon" href="https://troglobit.com/safari-pinned-tab.svg" color="#1b1c1d">
    <link rel="shortcut icon" href="https://troglobit.com/favicon.ico">
    <meta name="msapplication-TileColor" content="#1b1c1d">
    <meta name="theme-color" content="#1b1c1d">



<meta itemprop="name" content="Multicast routing with PIM-SM over GRE">
<meta itemprop="description" content="GRE tunnels are useful in many ways.  This blog post shows how to set up
multicast routing with pimd over a
GRE tunnel.  To achieve this we will also set up OSPF over GRE with
Quagga, because PIM, unlike DVMRP (mrouted),
require unicast routing rules to be established.
       .----{ Intranet }----.
      /    192.168.1.0/24    \
     /                        \
.10 /                          \.20
.--&#39;---. .1  GRE Tunnel  .2 .---`--.
|      |====================|      |
|  R1  |   172.16.16.0/30   |  R2  |
|      |                    |      |
&#39;--.---&#39;                    &#39;------&#39;
   | .1                        | .1 
   |    10.0.1.0/24            |    10.0.2.0/24
   | .2                        | .2 
.--&#39;---.                    .--&#39;---.
|      |                    |      |
|  C1  |                    |  C2  |
|      |                    |      |
&#39;------&#39;                    &#39;------&#39;
In this post we are using the home WiFi network, 192.168.1.0/24, to hook
up the GRE tunnel.  It is just as easy to extend this to a big corporate
Intranet with more routers between R1 and R2.  As long as that IT
department takes care of the unicast routing between R1 and R2 so
that the GRE tunnel can be established.">
<meta itemprop="datePublished" content="2018-01-23T20:39:36&#43;00:00" />
<meta itemprop="dateModified" content="2018-01-23T20:39:36&#43;00:00" />
<meta itemprop="wordCount" content="1590">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Multicast routing with PIM-SM over GRE"/>
<meta name="twitter:description" content="GRE tunnels are useful in many ways.  This blog post shows how to set up
multicast routing with pimd over a
GRE tunnel.  To achieve this we will also set up OSPF over GRE with
Quagga, because PIM, unlike DVMRP (mrouted),
require unicast routing rules to be established.
       .----{ Intranet }----.
      /    192.168.1.0/24    \
     /                        \
.10 /                          \.20
.--&#39;---. .1  GRE Tunnel  .2 .---`--.
|      |====================|      |
|  R1  |   172.16.16.0/30   |  R2  |
|      |                    |      |
&#39;--.---&#39;                    &#39;------&#39;
   | .1                        | .1 
   |    10.0.1.0/24            |    10.0.2.0/24
   | .2                        | .2 
.--&#39;---.                    .--&#39;---.
|      |                    |      |
|  C1  |                    |  C2  |
|      |                    |      |
&#39;------&#39;                    &#39;------&#39;
In this post we are using the home WiFi network, 192.168.1.0/24, to hook
up the GRE tunnel.  It is just as easy to extend this to a big corporate
Intranet with more routers between R1 and R2.  As long as that IT
department takes care of the unicast routing between R1 and R2 so
that the GRE tunnel can be established."/>




    <meta property="og:title" content="Multicast routing with PIM-SM over GRE" />
<meta property="og:description" content="GRE tunnels are useful in many ways.  This blog post shows how to set up
multicast routing with pimd over a
GRE tunnel.  To achieve this we will also set up OSPF over GRE with
Quagga, because PIM, unlike DVMRP (mrouted),
require unicast routing rules to be established.
       .----{ Intranet }----.
      /    192.168.1.0/24    \
     /                        \
.10 /                          \.20
.--&#39;---. .1  GRE Tunnel  .2 .---`--.
|      |====================|      |
|  R1  |   172.16.16.0/30   |  R2  |
|      |                    |      |
&#39;--.---&#39;                    &#39;------&#39;
   | .1                        | .1 
   |    10.0.1.0/24            |    10.0.2.0/24
   | .2                        | .2 
.--&#39;---.                    .--&#39;---.
|      |                    |      |
|  C1  |                    |  C2  |
|      |                    |      |
&#39;------&#39;                    &#39;------&#39;
In this post we are using the home WiFi network, 192.168.1.0/24, to hook
up the GRE tunnel.  It is just as easy to extend this to a big corporate
Intranet with more routers between R1 and R2.  As long as that IT
department takes care of the unicast routing between R1 and R2 so
that the GRE tunnel can be established." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://troglobit.com/2016/07/05/multicast-routing-with-pim-sm-over-gre/" />
<meta property="article:published_time" content="2018-01-23T20:39:36+00:00" />
<meta property="article:modified_time" content="2018-01-23T20:39:36+00:00" />




    <meta property="article:section" content="UNIX" />

    <meta property="article:section" content="multicast" />

    <meta property="article:section" content="PIM" />



    <meta property="article:published_time" content="2018-01-23 20:39:36 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://troglobit.com/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://troglobit.com/about/">About</a></li><li><a href="https://troglobit.com/posts/">Blog</a></li><li><a href="https://troglobit.com/howtos/">HowTos</a></li><li><a href="https://troglobit.com/projects/">Projects</a></li><li><a href="https://resume.troglobit.com">Resumé</a></li><li><a href="https://ftp.troglobit.com">FTP</a></li><li><a href="https://deb.troglobit.com">DEB</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        8 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://troglobit.com/2016/07/05/multicast-routing-with-pim-sm-over-gre/">Multicast routing with PIM-SM over GRE</a>
      </h1>

      

      

      <div class="post-content">
        <p>GRE tunnels are useful in many ways.  This blog post shows how to set up
multicast routing with <a href="https://github.com/troglobit/pimd/">pimd</a> over a
GRE tunnel.  To achieve this we will also set up OSPF over GRE with
<a href="http://www.quagga.net">Quagga</a>, because PIM, unlike DVMRP (<code>mrouted</code>),
require unicast routing rules to be established.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">       .----{ Intranet }----.
      /    192.168.1.0/24    \
     /                        \
.10 /                          \.20
.--&#39;---. .1  GRE Tunnel  .2 .---`--.
|      |====================|      |
|  R1  |   172.16.16.0/30   |  R2  |
|      |                    |      |
&#39;--.---&#39;                    &#39;------&#39;
   | .1                        | .1 
   |    10.0.1.0/24            |    10.0.2.0/24
   | .2                        | .2 
.--&#39;---.                    .--&#39;---.
|      |                    |      |
|  C1  |                    |  C2  |
|      |                    |      |
&#39;------&#39;                    &#39;------&#39;
</code></pre></div><p>In this post we are using the home WiFi network, 192.168.1.0/24, to hook
up the GRE tunnel.  It is just as easy to extend this to a big corporate
Intranet with more routers between <code>R1</code> and <code>R2</code>.  As long as that IT
department takes care of the unicast routing between <code>R1</code> and <code>R2</code> so
that the GRE tunnel can be established.</p>
<p>Now, on router R1 we set up the first GRE tunnel endpoint:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">ip tunnel add gre0 mode gre remote 192.168.1.20 <span class="nb">local</span> 192.168.1.10 ttl <span class="m">64</span>
ip link <span class="nb">set</span> gre0 multicast on
ip link <span class="nb">set</span> gre0 up
ip addr add 172.16.16.1/30 dev gre0
</code></pre></div><p>We do not add any static route for <code>R1</code> to reach the LAN on <code>R2</code> that
<code>C2</code> is connected to, that is for OSPF to add dynamically for us later.
Notice, hower, that we must explicitly enable the multicast flag on the
GRE interface, it is not enabled by default in Linux.</p>
<p>On router <code>R2</code> we can now set up the other side of the GRE tunnel:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">ip tunnel add gre0 mode gre remote 192.168.1.10 <span class="nb">local</span> 192.168.1.20 ttl <span class="m">64</span>
ip link <span class="nb">set</span> gre0 multicast on
ip link <span class="nb">set</span> gre0 up
ip addr add 172.16.16.2/30 dev gre0
</code></pre></div><p>Setup of OSPF in Debian or Ubuntu distributions is only an <code>apt-get</code>
away followed by enabling the zebra and ospf daemons:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo apt-get install quagga
sudo editor /etc/quagga/daemons
</code></pre></div><p>The idea is to set up an OSPF backbone, area 0, for our routers without
wrecking havoc in the big corporate intranet, which may already run OSPF
&hellip; so OSPF should only talk on the <code>gre0</code> interface, and maybe even the
LAN interfaces towards <code>C1</code> and <code>C2</code> (in case we want to expand on this
example later).  In our setup the routers use <code>wlan0</code> to connect to the
intranet.  We can use the sample configuration files to start from:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo cp /usr/share/doc/quagga/examples/zebra.conf.sample /etc/quagga/zebra.conf
sudo cp /usr/share/doc/quagga/examples/ospfd.conf.sample /etc/quagga/ospfd.conf
</code></pre></div><p>The <code>zebra.conf</code> can be left as-is, just edit the <code>ospfd.conf</code> to look
like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">hostname ospfd
password zebra
router ospf
    passive-interface wlan0
    redistribute connected
    network 172.16.16.0/30 area 0
</code></pre></div><p>When the routers have peered, the two clients <code>C1</code> and <code>C2</code> should be
able to (unicast) ping each other.  Telnet into the OSPF daemon using
<code>telnet localhost ospfd</code> and type <code>show ip ospf neigh</code> to see all OSPF
neighbors and their status, should be <code>Full/...</code> when done exchanging
routes.  Use <code>show ip ospf route</code> to see the exchanged routes, also
inspect the kernel routing table with <code>route -n</code>.  Use <code>traceroute</code> to
confirm the traffic between clients do traverse the GRE tunnel and not
over the Intranet.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@C1:~$ traceroute 10.0.2.2
traceroute to 10.0.2.2 <span class="o">(</span>10.0.2.2<span class="o">)</span>, <span class="m">30</span> hops max, <span class="m">60</span> byte packets
 <span class="m">1</span>  10.0.1.1 <span class="o">(</span>10.0.1.1<span class="o">)</span>  0.427 ms  0.384 ms  0.309 ms
 <span class="m">2</span>  172.16.16.2 <span class="o">(</span>172.16.16.2<span class="o">)</span>  3.135 ms  4.724 ms  5.786 ms
 <span class="m">3</span>  10.0.2.2 <span class="o">(</span>10.0.2.2<span class="o">)</span>  9.979 ms  10.777 ms  10.676 ms
</code></pre></div><p>Time for <code>pimd</code> to be started.  Just like OSPF we want <code>pimd</code> to avoid
talking on <code>wlan0</code>, so add the following to the default <code>pimd.conf</code>,
which can otherwise be left as-is:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">phyint wlan0 disable
</code></pre></div><p>In our case the routers have many interfaces, so we disable <em>all</em>
interfaces using the <code>-N</code> switch to <code>pimd</code> and instead only enable the
interfaces we are intrested in, the GRE tunnel and the client LAN
interface, <code>eth0</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">phyint eth0 enable
phyint gre0 enable
</code></pre></div><p>Make sure to add the <code>phyint</code> setting to the correct place in the file.
Now start pimd on each router, use the debug mode and run in foreground
first to see what happens:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@R1:~$ pimd -N -f -d
debug level 0xffffffff <span class="o">(</span>dvmrp_detail,dvmrp_prunes,dvmrp_routes,dvmrp_neighbors,dvmrp_timers,igmp_proto,igmp_timers,igmp_members,trace,timeout,packets,interfaces,kernel,cache,rsrr,pim_detail,pim_hello,pim_register,pim_join_prune,pim_bootstrap,pim_asserts,pim_cand_rp,pim_routes,pim_timers,pim_rpf<span class="o">)</span>
02:01:49.616 pimd version 2.3.2 starting ...
02:01:49.617 Got <span class="m">262144</span> byte send buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte recv buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte send buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte recv buffer size in <span class="m">0</span> iterations
02:01:49.617 Getting vifs from kernel
02:01:49.618 /etc/pimd.conf:0 - Skipping interface lo, either loopback or does not support multicast.
</code></pre></div><p>&hellip; and on <code>R2</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@R2:~$ pimd -N -f -d
debug level 0xffffffff <span class="o">(</span>dvmrp_detail,dvmrp_prunes,dvmrp_routes,dvmrp_neighbors,dvmrp_timers,igmp_proto,igmp_timers,igmp_members,trace,timeout,packets,interfaces,kernel,cache,rsrr,pim_detail,pim_hello,pim_register,pim_join_prune,pim_bootstrap,pim_asserts,pim_cand_rp,pim_routes,pim_timers,pim_rpf<span class="o">)</span>
02:01:49.616 pimd version 2.3.2 starting ...
02:01:49.617 Got <span class="m">262144</span> byte send buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte recv buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte send buffer size in <span class="m">0</span> iterations
02:01:49.617 Got <span class="m">262144</span> byte recv buffer size in <span class="m">0</span> iterations
02:01:49.617 Getting vifs from kernel
02:01:49.618 /etc/pimd.conf:0 - Skipping interface lo, either loopback or does not support multicast.
</code></pre></div><p>To verify multicast routing works we start a multicast sender on <code>C1</code>
and a receiver (sink) on <code>C2</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@C1:~$ mcjoin -s -t <span class="m">10</span>
root@C2:~$ mcjoin
.................o
</code></pre></div><p>Notice the TTL adjustment (<code>-t 10</code>) on the sender side, this is needed
because the default TTL for multicast, due to safety concerns, is 1.</p>
<p>The log on the routers should look something like this (snippet):</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">01:44:16.750 accept_group_report(): igmp_src 10.0.2.2 ssm_src 0.0.0.0 group 225.1.2.3 report_type 34
01:44:16.750 Set delete timer for group: 225.1.2.3
01:44:16.750 Adding vif 4 for group 225.1.2.3
01:44:16.877 Received IGMP v3 Membership Report from 172.16.16.1 to 224.0.0.22
01:44:16.877 accept_membership_report(): IGMP v3 report, 40 bytes, from 172.16.16.1 to 224.0.0.22 with 4 group records.

Virtual Interface Table ======================================================
Vif  Local Address    Subnet              Thresh  Flags      Neighbors
---  ---------------  ------------------  ------  ---------  -----------------
  0  192.168.1.123    192.168.1                1  DISABLED
  1  172.17.0.1       172.17                   1  DISABLED
  2  192.168.122.1    192.168.122              1  DISABLED
  3  172.16.16.2      172.16.16/30             1  DR PIM     172.16.16.1
  4  10.0.2.1         10.0.2                   1  DR NO-NBR
  5  172.16.16.2      register_vif0            1 

 Vif  SSM Group        Sources             


Multicast Routing Table ======================================================
----------------------------------- (*,G) ------------------------------------
Source           Group            RP Address       Flags
---------------  ---------------  ---------------  ---------------------------
INADDR_ANY       225.1.2.3        10.0.2.1         WC RP
Joined   oifs: ......              
Pruned   oifs: ......              
Leaves   oifs: ....l.              
Asserted oifs: ......              
Outgoing oifs: ....o.              
Incoming     : .....I              

TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4  5
             0    45     0       0        0  0  0  0  0  0
----------------------------------- (S,G) ------------------------------------
Source           Group            RP Address       Flags
---------------  ---------------  ---------------  ---------------------------
192.168.64.2     225.1.2.3        10.0.2.1         SPT CACHE SG
Joined   oifs: ......              
Pruned   oifs: ......              
Leaves   oifs: ....l.              
Asserted oifs: ......              
Outgoing oifs: ....o.              
Incoming     : ...I..              

TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4  5
           200    55     0       0        0  0  0  0  0  0
--------------------------------- (*,*,G) ------------------------------------
Number of Groups: 1
Number of Cache MIRRORs: 1
------------------------------------------------------------------------------

Candidate Rendezvous-Point Set ===============================================
RP address       Incoming  Group Prefix        Priority  Holdtime
---------------  --------  ------------------  --------  ---------------------
10.0.2.1         5         224/4               20        70      
10.0.1.1         3         224/4               20        55      
169.254.0.1      1         232/8               1         65535   
------------------------------------------------------------------------------
Current BSR address: 10.0.2.1
</code></pre></div><p>In normal operation, i.e. without the debug flag <code>-d</code>, the routing table
and other useful PIM information can be queried from the running <code>pimd</code>
by calling it in client mode.  The following is a wrapper for sending a
<code>SIGUSR1</code> signal to the daemon and reading <code>/var/run/pimd/pimd.dump</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">root@R2:~$ pimd -r
Virtual Interface Table ======================================================
Vif  Local Address    Subnet              Thresh  Flags      Neighbors
---  ---------------  ------------------  ------  ---------  -----------------
  0  192.168.1.123    192.168.1                1  DISABLED
  1  172.17.0.1       172.17                   1  DISABLED
  2  192.168.122.1    192.168.122              1  DISABLED
  3  172.16.16.2      172.16.16/30             1  DR PIM     172.16.16.1    
  4  10.0.2.1         10.0.2                   1  DR NO-NBR
  5  172.16.16.2      register_vif0            1 

 Vif  SSM Group        Sources             

Multicast Routing Table ======================================================
----------------------------------- (*,G) ------------------------------------
Source           Group            RP Address       Flags
---------------  ---------------  ---------------  ---------------------------
INADDR_ANY       225.1.2.3        10.0.2.1         WC RP
Joined   oifs: ......              
Pruned   oifs: ......              
Leaves   oifs: ....l.              
Asserted oifs: ......              
Outgoing oifs: ....o.              
Incoming     : .....I              

TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4  5
             0    20     0       0        0  0  0  0  0  0
----------------------------------- (S,G) ------------------------------------
Source           Group            RP Address       Flags
---------------  ---------------  ---------------  ---------------------------
10.0.1.2         225.1.2.3        10.0.2.1         SPT CACHE SG
Joined   oifs: ......              
Pruned   oifs: ......              
Leaves   oifs: ....l.              
Asserted oifs: ......              
Outgoing oifs: ....o.              
Incoming     : ...I..              

TIMERS:  Entry    JP    RS  Assert VIFS:  0  1  2  3  4  5
           185    10     0       0        0  0  0  0  0  0
--------------------------------- (*,*,G) ------------------------------------
Number of Groups: 1
Number of Cache MIRRORs: 1
------------------------------------------------------------------------------
</code></pre></div><p>You can also verify that <code>pimd</code> actually sets routes in the kernel
multicast routing table with:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">root@R2:~$ ip mroute
<span class="o">(</span>10.0.1.2, 225.1.2.3<span class="o">)</span>        Iif: gre0       Oifs: eth0
</code></pre></div><h2 id="caveats">Caveats</h2>
<p>There are quite a few caveats to watch out for with multicast routing.
Here are a few:</p>
<ol>
<li>Check the TTL of the multicast stream, must be &gt;1 to be routed.
<strong>Rule of thumb:</strong> increase with each router in topology.</li>
<li>Check the MTU of the interfaces in the path.</li>
<li>Check the reverse path, make sure you have unicast connectivity
between end nodes &ndash; PIM requires this to work!</li>
<li>Check the multicast sender&rsquo;s source IP, verify that it&rsquo;s not a
unroutable link-local (169.254) address.</li>
<li>Have the PIM routers peered?  Should list &lsquo;PIM&rsquo; and a neighbor IP
in the output of <code>pimd -r</code>.  If NO-NBR or DISABLED is shown you
have a network or <code>pimd.conf</code> problem.</li>
<li>As of this writing <code>pimd</code> is a bit sensitive to topology changes.
See <a href="https://github.com/troglobit/pimd/issues/79">issue #79</a> for
details and possible future resolution.</li>
</ol>
<p>For other questions, ideas on setting up multicast routing, see the
general <a href="https://troglobit.com/multicast-howto.html">Multicast HowTo</a>, or file a bug report
at <a href="https://github.com/troglobit">GitHub</a></p>
<p>That&rsquo;s it, good luck!</p>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://troglobit.com/categories/unix/">UNIX</a></span>
        <span class="tag"><a href="https://troglobit.com/categories/multicast/">multicast</a></span>
        <span class="tag"><a href="https://troglobit.com/categories/pim/">PIM</a></span>
        
    </p>


      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        1590 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2018-01-23 21:39
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;caption=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;canonicalUrl=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;body=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f&amp;media=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f;description=Multicast%20routing%20with%20PIM-SM%20over%20GRE" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f&amp;title=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;summary=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;source=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f&amp;resubmit=true&amp;title=Multicast%20routing%20with%20PIM-SM%20over%20GRE" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f;title=Multicast%20routing%20with%20PIM-SM%20over%20GRE" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Multicast%20routing%20with%20PIM-SM%20over%20GRE%20https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f&amp;t=Multicast%20routing%20with%20PIM-SM%20over%20GRE" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Multicast%20routing%20with%20PIM-SM%20over%20GRE&amp;url=https%3a%2f%2ftroglobit.com%2f2016%2f07%2f05%2fmulticast-routing-with-pim-sm-over-gre%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://troglobit.com/post/2018-02-15-slow-down/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Slow Down</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://troglobit.com/2017/09/19/threads-vs-event-loop-again/">
                    <span class="button__text">Threads vs Event Loop, Again ...</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://troglobit.com/">Joachim Wiberg</a></span>
            <span>UNIX&trade; 4Life! &#9994;</span><span><a href="https://troglobit.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="https://troglobit.com/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js" integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj&#43;AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script>



    </body>
</html>
