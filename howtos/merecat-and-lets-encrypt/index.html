<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Troglobit - HowTo: Set up Merecat with Let&#39;s Encrypt certificate</title>
<meta property="og:title" content=Troglobit&#32;-&#32;HowTo:&#32;Set&#32;up&#32;Merecat&#32;with&#32;Let&#39;s&#32;Encrypt&#32;certificate />
<meta name="twitter:title" content=Troglobit&#32;-&#32;HowTo:&#32;Set&#32;up&#32;Merecat&#32;with&#32;Let&#39;s&#32;Encrypt&#32;certificate />
<meta itemprop="name" content=Troglobit&#32;-&#32;HowTo:&#32;Set&#32;up&#32;Merecat&#32;with&#32;Let&#39;s&#32;Encrypt&#32;certificate />
<meta name="application-name" content=Troglobit&#32;-&#32;HowTo:&#32;Set&#32;up&#32;Merecat&#32;with&#32;Let&#39;s&#32;Encrypt&#32;certificate />
<meta property="og:site_name" content="Joachim Wiberg" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://troglobit.com/howtos/merecat-and-lets-encrypt/" />
<link rel="canonical" href="https://troglobit.com/howtos/merecat-and-lets-encrypt/" itemprop="url" />
<meta name="url" content="https://troglobit.com/howtos/merecat-and-lets-encrypt/" />
<meta name="twitter:url" content="https://troglobit.com/howtos/merecat-and-lets-encrypt/" />
<meta property="og:url" content="https://troglobit.com/howtos/merecat-and-lets-encrypt/" />


<meta property="og:updated_time" content="2020-07-15T14:10:00Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://troglobit.com/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Joachim Wiberg" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.38582ad6358fd7e8681326fd2f2f83c1056c6fa45c4872e09a3760b866676227.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://troglobit.com/">
                <img src="/images/profile.jpg" alt="brand image">
            </a>
        
        
            <a href="https://troglobit.com/">
                <h1>Troglobit</h1>
            </a>
        
    </h1>
    <p class="lead">
    
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2025-01-05-testing-network-daemons/">Testing Network Daemons</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2024-08-07-buildroot-development-environment/">Buildroot Development Environment</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/projects/">Projects</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/finit/">Fast init for Linux systems</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/smcroute/">Static Multicast Routing Daemon</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/howtos/">HowTos</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/snmp/">HowTo play with SNMP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/multicast/">Multicast HowTo</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/troglobit">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/joachim-wiberg-3a017125">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>















    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto:Joachim%20Wiberg%20%3ctroglobit&#43;spam@gmail.com%3e">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 Joachim Wiberg. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://troglobit.com/howtos/merecat-and-lets-encrypt/">HowTo: Set up Merecat with Let&#39;s Encrypt certificate</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2020-07-15T14:10:00Z" class="post-date">
        July 15, 2020
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>8 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-merecat">
        <a href="https://troglobit.com/tags/merecat">merecat</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>This is a HowTo for setting up <a href="https://merecat.troglobit.com" target="_blank">Merecat httpd</a> with <a href="https://letsencrypt.org/" target="_blank">Let&rsquo;s
Encrypt</a> HTTPS certificates.</p>
<p>The upcoming v2.32 release of <a href="https://merecat.troglobit.com" target="_blank">Merecat</a> supports HTTPS as well as
serving more than one Internet port.  This is highly useful for those
who want to serve both HTTPS and HTTP content.</p>
<blockquote>
<p><strong>Update:</strong> now with support for <code>--webroot</code> and HTTP-01 renewal!</p>
</blockquote>
<h2 id="getting-the-source">Getting the Source</h2>
<p>To start with, you need the latest release of <a href="https://merecat.troglobit.com" target="_blank">Merecat</a>.  Note, if you
are reading this before Merecat v2.32 has been released you can use the
latest software from the GitHub master branch.  Note, you need OpenSSL
and a few other packages, see the README file for details:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/troglobit/merecat.git
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">cd</span> merecat/
</span></span><span style="display:flex;"><span>./autogen.sh
</span></span><span style="display:flex;"><span>./configure
</span></span><span style="display:flex;"><span>make package
</span></span><span style="display:flex;"><span>sudo dpkg -i ../merecat_2.32-1_amd64.deb
</span></span></code></pre></div><h2 id="starting-certbot">Starting Certbot</h2>
<p>If you already have at least version v2.32 of <a href="https://merecat.troglobit.com" target="_blank">Merecat</a> installed you
can begin the process of getting a Let&rsquo;s Encrypt certificate.  This
HowTo use the EFF&rsquo;s certbot, which is available in Ubuntu or from the
Let&rsquo;s Encrypt homepage:</p>
<pre>
root@example:/var/www# <b>systemctl stop merecat.service</b>
root@example:/var/www# <b>certbot certonly --standalone</b>
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer None
Enter email address (used for urgent renewal and security notices)  (Enter 'c'
to cancel): <b>admin@example.com</b>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please read the Terms of Service at
https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
agree in order to register with the ACME server at
https://acme-v02.api.letsencrypt.org/directory
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(A)gree/(C)ancel: <b>a</b>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing to share your email address with the Electronic Frontier
Foundation, a founding partner of the Let's Encrypt project and the non-profit
organization that develops Certbot? We'd like to send you email about our work
encrypting the web, EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: <b>y</b>
Please enter in your domain name(s) (comma and/or space separated)  (Enter 'c'
to cancel): example.com *.example.com
Obtaining a new certificate
Performing the following challenges:
Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.
Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA. You may need to use an authenticator plugin that can do challenges over DNS.

IMPORTANT NOTES:
 - Your account credentials have been saved in your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.
</pre>
<p>Oups, that didn&rsquo;t go as planned &hellip; well, it turns out the version of
certbot in Ubuntu 18.04 lacks support for <em>wildcard certificates</em>.  We
can either go to their homepage and get the latest version, or list all
the domains we need:</p>
<pre>
root@example:/var/www# <b>certbot certonly --standalone</b>
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer None
Please enter in your domain name(s) (comma and/or space separated)  (Enter 'c'
to cancel): <b>example.com www.example.com git.example.com ftp.example.com deb.example.com</b>
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for example.com
http-01 challenge for deb.example.com
http-01 challenge for ftp.example.com
http-01 challenge for git.example.com
http-01 challenge for www.example.com
Waiting for verification...
Cleaning up challenges

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/example.com/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/example.com/privkey.pem
   Your cert will expire on 2019-09-24. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot
   again. To non-interactively renew *all* of your certificates, run
   "certbot renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</pre>
<p>The <a href="https://certbot.eff.org/lets-encrypt/ubuntubionic-other" target="_blank">Let&rsquo;s Encrypt setup guide</a> at this point recommends that
we verify that automatic certificate renewal works (cronjob or systemd
timer).  If this doesn&rsquo;t work, your certificate will expire after only
six months!  So let&rsquo;s check that now:</p>
<pre>
root@example:/var/www# <b>certbot renew --dry-run</b>
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Processing /etc/letsencrypt/renewal/example.com.conf
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Cert not due for renewal, but simulating renewal for dry run
Plugins selected: Authenticator standalone, Installer None
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for deb.example.com
http-01 challenge for ftp.example.com
http-01 challenge for git.example.com
http-01 challenge for merecat.example.com
http-01 challenge for example.com
http-01 challenge for www.example.com
Waiting for verification...
Cleaning up challenges

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
new certificate deployed without reload, fullchain is
/etc/letsencrypt/live/example.com/fullchain.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates below have not been saved.)

Congratulations, all renewals succeeded. The following certs have been renewed:
  /etc/letsencrypt/live/example.com/fullchain.pem (success)
** DRY RUN: simulating 'certbot renew' close to cert expiry
**          (The test certificates above have not been saved.)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Your account credentials have been saved in your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.

root@example:/var/www#
</pre>
<p>It is recommended to also set up Diffie-Hellman paramaters.  For this
you need to genereate a site specific file:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>root@example:/var/www# openssl dhparam -out certs/dhparam.pem <span style="color:#d3869b">2048</span>
</span></span><span style="display:flex;"><span>Generating DH parameters, <span style="color:#d3869b">2048</span> bit long safe prime, generator <span style="color:#d3869b">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This is going to take a long <span style="color:#fabd2f">time</span>
</span></span><span style="display:flex;"><span>........................................................+.........................................................................
</span></span><span style="display:flex;"><span>.......+......................................+...................................................................................
</span></span><span style="display:flex;"><span>.............................................................................................+....................................
</span></span><span style="display:flex;"><span>..................................................................................................................................
</span></span><span style="display:flex;"><span>......................................................................+...........................................................
</span></span><span style="display:flex;"><span>............................................................................................................................+.....
</span></span><span style="display:flex;"><span>..................................................................................................................................
</span></span><span style="display:flex;"><span>.+.......+........................................................................................................................
</span></span><span style="display:flex;"><span>.........................+........................................................................................................
</span></span><span style="display:flex;"><span>.................+.............................................................++*++*++*++*
</span></span><span style="display:flex;"><span>root@example:/var/www#
</span></span></code></pre></div><p>The <code>/etc/merecat.conf</code> file for a site with a couple of virtual hosts,
look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>## /etc/merecat.conf                                     -*-conf-unix-*-
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>virtual-host     = true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>user-agent-deny  = &#34;**SemrushBot**|**MJ12bot**|**DotBot**&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server default {
</span></span><span style="display:flex;"><span>    port     = 80
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server secure {
</span></span><span style="display:flex;"><span>    port     = 443
</span></span><span style="display:flex;"><span>    ssl {
</span></span><span style="display:flex;"><span>        certfile = /etc/letsencrypt/live/example.com/fullchain.pem
</span></span><span style="display:flex;"><span>        keyfile  = /etc/letsencrypt/live/example.com/privkey.pem
</span></span><span style="display:flex;"><span>        dhfile   = certs/dhparam.pem
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <a href="https://merecat.troglobit.com" target="_blank">Merecat</a> defaults take care of a lot of the nasty details you
shouldn&rsquo;t have to bother with, and unlike other web servers the virtual
host setup is done in the file system rather than in the configuration
file.  See <a href="https://merecat.troglobit.com" target="_blank">Merecat</a> docs for details.</p>
<p>With everything set up we can fire it up:</p>
<pre>
root@example:/var/www# <b>systemctl start merecat.service</b>
</pre>
<h2 id="http-01-renewal">HTTP-01 Renewal</h2>
<p>For automatic renewal to work you need a new (July 2020) feature of
Merecat, called location matching:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>server default {
</span></span><span style="display:flex;"><span>        port = 80
</span></span><span style="display:flex;"><span>        location &#34;/.well-known/acme-challenge/**&#34; {
</span></span><span style="display:flex;"><span>                 path = &#34;letsencrypt/.well-known/acme-challenge/&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        redirect &#34;/**&#34; {
</span></span><span style="display:flex;"><span>                 code = 301
</span></span><span style="display:flex;"><span>                 location = &#34;https://$host$request_uri$args&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>path</code> must be relative to the server root directory.  Use bind
mounts to get <code>/var/lib/letsencrypt</code> into your server root.  This way
we can ensure <code>certbot</code> only writes to its own directory and cannot
write to any file in the server root.</p>
<p>Then run <code>certbot</code> with the following arguments and then add all virtual
hosts you want to support from Merecat:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>root@example:/var/www/&gt; certbot certonly --webroot --webroot-path /var/lib/letsencrypt --dry-run
</span></span></code></pre></div><p>Drop <code>--dry-run</code> when you&rsquo;re done playing around learning all settings.</p>
<p>The actual renewal is set up automatically by the certbot install as a
cronjob or systemd timer.  Certbot uses the last known method you used
to manually install/update your certs.  For details on this, see the
file <code>/etc/letsencrypt/renewal/example.com.conf</code>.  (Dry runs does not
change this.)</p>
<p>After a successful renewal you need to restart Merecat httpd to activate
the new certificates.  Instead of modifying the above cronjob or timer,
we add the following line to <code>/etc/letsencrypt/cli.ini</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>deploy-hook = systemctl restart merecat
</span></span></code></pre></div>
  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://troglobit.com/howtos/merecat-basic-cig-in-c/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Basic CGI in C with Merecat httpd</a>
        
	    
            <div class="next-post">
                <a href="https://troglobit.com/howtos/netbsd-pkgsrc/?ref=footer"><span style="font-weight:bold;">Next »</span><br>HowTo use NetBSD pre-built packages</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#getting-the-source">Getting the Source</a></li>
    <li><a href="#starting-certbot">Starting Certbot</a></li>
    <li><a href="#http-01-renewal">HTTP-01 Renewal</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
