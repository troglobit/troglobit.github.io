<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Troglobit - Finit in Linux Containers (LXC)</title>
<meta property="og:title" content=Troglobit&#32;-&#32;Finit&#32;in&#32;Linux&#32;Containers&#32;(LXC) />
<meta name="twitter:title" content=Troglobit&#32;-&#32;Finit&#32;in&#32;Linux&#32;Containers&#32;(LXC) />
<meta itemprop="name" content=Troglobit&#32;-&#32;Finit&#32;in&#32;Linux&#32;Containers&#32;(LXC) />
<meta name="application-name" content=Troglobit&#32;-&#32;Finit&#32;in&#32;Linux&#32;Containers&#32;(LXC) />
<meta property="og:site_name" content="Joachim Wiberg" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/" />
<link rel="canonical" href="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/" itemprop="url" />
<meta name="url" content="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/" />
<meta name="twitter:url" content="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/" />
<meta property="og:url" content="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/" />


<meta property="og:updated_time" content="2022-02-13T17:55:44&#43;02:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://troglobit.com/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@troglobit" />
    <meta name="twitter:creator" content="@troglobit" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Joachim Wiberg" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.38582ad6358fd7e8681326fd2f2f83c1056c6fa45c4872e09a3760b866676227.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://troglobit.com/">
                <img src="/images/profile.jpg" alt="brand image">
            </a>
        
        
            <a href="https://troglobit.com/">
                <h1>Troglobit</h1>
            </a>
        
    </h1>
    <p class="lead">
    
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2024-08-07-buildroot-development-environment/">Buildroot Development Environment</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2024-03-03-building-emacs-with-jit/">Building Emacs with JIT</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/projects/">Projects</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/finit/">Fast init for Linux systems</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/smcroute/">Static Multicast Routing Daemon</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/howtos/">HowTos</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/snmp/">HowTo play with SNMP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/multicast/">Multicast HowTo</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/troglobit">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/joachim-wiberg-3a017125">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="X" href="https://x.com/troglobit">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 512 472.799">
            <path fill="currentColor" d="M403.229 0h78.506L310.219 196.04 512 462.799H354.002L230.261 301.007 88.669 462.799h-78.56l183.455-209.683L0 0h161.999l111.856 147.88L403.229 0zm-27.556 415.805h43.505L138.363 44.527h-46.68l283.99 371.278z"/>
        </svg>
    </a>



    <a target="_blank" class="social" rel="me" title="Mastodon" href="https://fosstodon.org/@troglobit">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26c-1.31.15-2.6.3-3.97.24c-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42c1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5c-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56 0 5.02.3 6.47.96c0 0 2.83 1.27 2.83 5.61c0 0 .04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56c-.56-.63-1.3-.96-2.23-.96c-1.06 0-1.87.41-2.42 1.23l-.5.88l-.5-.88c-.56-.82-1.36-1.23-2.43-1.23c-.92 0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62c1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93c.9 0 1.35.56 1.35 1.62v5.11H18V8.91Z"/>
        </svg>
    </a>











    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto:Joachim%20Wiberg%20%3ctroglobit&#43;spam@gmail.com%3e">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 Joachim Wiberg. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://troglobit.com/post/2022-02-13-finit-in-linux-containers-lxc/">Finit in Linux Containers (LXC)</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2022-02-13T17:55:44&#43;0200" class="post-date">
        February 13, 2022
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>3 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-howto">
        <a href="https://troglobit.com/tags/howto">howto</a>
      </li>
      
      <li class="tag-finit">
        <a href="https://troglobit.com/tags/finit">finit</a>
      </li>
      
      <li class="tag-init">
        <a href="https://troglobit.com/tags/init">init</a>
      </li>
      
      <li class="tag-opensource">
        <a href="https://troglobit.com/tags/opensource">opensource</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>This is a mini-HowTo on running Finit in an LXC system container.  We
will be using a variant (external) of Buildroot, called <a href="https://github.com/westermo/netbox" target="_blank">NetBox</a> to
create a squashfs (read-only) image for the root filesystem.  Then we
will give the container a single writable directory from which it then
uses bind mount to emulate a full-blown system.</p>
<p>It is expected you have LXC installed and all the relevant build tools
needed to create the image.  How to set that up is not covered by this
tutorial.</p>
<p>First we clone NetBox and build an app image for Zero (x86_64):</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/westermo/netbox
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">cd</span> netbox
</span></span><span style="display:flex;"><span>make netbox_app_zero_defconfig
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><p>After a few minutes the build has completed and in the <code>output/images/</code>
directory we have the <code>netbox-app-zero.img</code> which we now can set up an
LXC config file for.  Make sure to create the appropriate directories as
we proceed.  Start by copying the .img file to the LXC images directory,
then create this file:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#928374;font-style:italic"># /var/lib/lxc/foo/config </span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>uts<span style="color:#fe8019">.</span>name <span style="color:#fe8019">=</span> foo
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>tty<span style="color:#fe8019">.</span>max <span style="color:#fe8019">=</span> <span style="color:#d3869b">4</span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>pty<span style="color:#fe8019">.</span>max<span style="color:#fe8019">=</span><span style="color:#d3869b">1024</span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.hook.pre-mount = pre-mount.sh /var/lib/lxc/images/foo.img /var/lib/lxc/foo/rootfs</span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.rootfs.path    = overlayfs:/var/lib/lxc/foo/rootfs:/var/lib/lxc/foo/delta0</span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.rootfs.options = -t squashfs</span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>rootfs<span style="color:#fe8019">.</span>path <span style="color:#fe8019">=</span> loop:<span style="color:#fe8019">/</span><span style="color:#fe8019">var</span><span style="color:#fe8019">/</span>lib<span style="color:#fe8019">/</span>lxc<span style="color:#fe8019">/</span>images<span style="color:#fe8019">/</span>netbox<span style="color:#fe8019">-</span>app<span style="color:#fe8019">-</span>zero<span style="color:#fe8019">.</span>img
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>mount<span style="color:#fe8019">.</span>auto <span style="color:#fe8019">=</span> cgroup:mixed proc:mixed sys:mixed
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.mount.entry=run run tmpfs rw,nodev,relatime,mode=755 0 0</span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.mount.entry=shm dev/shm tmpfs rw,nodev,noexec,nosuid,relatime,mode=1777,create=dir 0 0</span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>mount<span style="color:#fe8019">.</span>entry<span style="color:#fe8019">=/</span><span style="color:#fe8019">var</span><span style="color:#fe8019">/</span>lib<span style="color:#fe8019">/</span>lxc<span style="color:#fe8019">/</span>foo<span style="color:#fe8019">/</span>mnt mnt none bind <span style="color:#d3869b">0</span> <span style="color:#d3869b">0</span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>net<span style="color:#fe8019">.</span><span style="color:#d3869b">0.</span>type <span style="color:#fe8019">=</span> veth
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>net<span style="color:#fe8019">.</span><span style="color:#d3869b">0.</span>flags <span style="color:#fe8019">=</span> up
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>net<span style="color:#fe8019">.</span><span style="color:#d3869b">0.</span>link <span style="color:#fe8019">=</span> lxcbr0
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.init.cmd = /sbin/init finit.debug</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic">#lxc.seccomp.profile = /usr/share/lxc/config/common.seccomp</span>
</span></span><span style="display:flex;"><span>lxc<span style="color:#fe8019">.</span>apparmor<span style="color:#fe8019">.</span>profile <span style="color:#fe8019">=</span> lxc<span style="color:#fe8019">-</span>container<span style="color:#fe8019">-</span>default<span style="color:#fe8019">-</span>with<span style="color:#fe8019">-</span>mounting
</span></span></code></pre></div><p>As can be seen from the example config above, there are many ways to
skin this cat.  This time around are focusing on the uncommented lines
which loop mount the image, mounts a mix of the kernel file systems and
a writable directory on <code>/mnt</code> in the container&rsquo;s namespace.  We also
set up basic networking, which will only work if you have the <code>lxcbr0</code>
bridge interface on your host system.</p>
<p>Notice the AppArmor profile used, you my need to extend it with the
following extra permissions at the bottom:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># /etc/apparmor.d/lxc/lxc-default-with-mounting
</span></span><span style="display:flex;"><span>mount fstype=tmpfs,
</span></span><span style="display:flex;"><span>mount fstype=overlay,
</span></span></code></pre></div><p>Reload AppArmor, or restart your system to activate the changes, then we
can start the container with:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ sudo lxc-start -n foo -F
</span></span><span style="display:flex;"><span>● ● ●  NetBox - The Networking Toolbox ═════════════════════════════════
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Mounting filesystems
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Populating device tree
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Restoring system clock <span style="color:#fe8019">(</span>UTC<span style="color:#fe8019">)</span> from RTC
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Initializing random number generator
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Starting System log daemon
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Starting networking
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Starting SSH daemon
</span></span><span style="display:flex;"><span><span style="color:#fe8019">[</span> OK <span style="color:#fe8019">]</span> Calling /etc/rc.local
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Welcome to Buildroot
</span></span><span style="display:flex;"><span>buildroot login: root
</span></span><span style="display:flex;"><span>                       .--.--.--.-----.-----.-------.-----.----.--------.-----.
</span></span><span style="display:flex;"><span>   Welcome to NetBox   |  |  |  |  -__|__ --|_     _|  -__|   _|        |  _  |
</span></span><span style="display:flex;"><span>    Made by Westermo   |________|_____|_____| |___| |_____|__| |__|__|__|_____|
</span></span><span style="display:flex;"><span>                                                       https://www.westermo.com
</span></span><span style="display:flex;"><span>NetBox 2021.02-r0-206-g0eba0db-dirty -- Feb <span style="color:#d3869b">13</span> 19:25 CET <span style="color:#d3869b">2022</span>
</span></span><span style="display:flex;"><span>Type: <span style="color:#b8bb26">&#39;help&#39;</span> <span style="color:#fe8019">for</span> <span style="color:#fabd2f">help</span> with commands, <span style="color:#b8bb26">&#39;exit&#39;</span> to log out.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@buildroot:~# 
</span></span></code></pre></div><p>Type <code>poweroff</code> to terminate the container.  To start it in the
background, omit <code>-F</code> above, then use <code>lxc-attach</code> to connect (and
disconnect) from it.</p>
  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://troglobit.com/post/2022-01-24-gmail-and-git-send-email/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Gmail and git send-email</a>
        
	    
            <div class="next-post">
                <a href="https://troglobit.com/post/2022-04-11-linux-kernel-development-checklist/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Linux Kernel Development Checklist</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents"></nav>
    </div>
</div>

  

        </div>
    </body>
</html>
