<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Joachim Wiberg ">
<meta name="description" content="
This is a blog post about Finit. Each post is concluded with a video summarizing the topic. The impatient reader can scroll down to the video.
Most non-trivial systems require dependency tracking between services. Not only does it help ensure correct operation, it is also an enabler for starting services in parallel. Less known, but just as important, is handling dependencies at system reconfiguration.
" />
<meta name="keywords" content=", finit, init, opensource" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://troglobit.com/post/2022-01-09-dependency-handling-in-finit/" />


    <title>
        
            Dependency handling in Finit :: Joachim Wiberg 
        
    </title>





<link rel="stylesheet" href="https://troglobit.com/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css" integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE=">



    <link rel="apple-touch-icon" sizes="180x180" href="https://troglobit.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://troglobit.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://troglobit.com/favicon-16x16.png">
    <link rel="manifest" href="https://troglobit.com/site.webmanifest">
    <link rel="mask-icon" href="https://troglobit.com/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://troglobit.com/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Dependency handling in Finit">
<meta itemprop="description" content="
This is a blog post about Finit.  Each post is concluded with a video
summarizing the topic.  The impatient reader can scroll down to the
video.
Most non-trivial systems require dependency tracking between services.
Not only does it help ensure correct operation, it is also an enabler
for starting services in parallel.  Less known, but just as important,
is handling dependencies at system reconfiguration."><meta itemprop="datePublished" content="2022-01-09T18:46:23+01:00" />
<meta itemprop="dateModified" content="2022-01-09T18:46:23+01:00" />
<meta itemprop="wordCount" content="398">
<meta itemprop="keywords" content="finit,init,opensource," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Dependency handling in Finit"/>
<meta name="twitter:description" content="
This is a blog post about Finit.  Each post is concluded with a video
summarizing the topic.  The impatient reader can scroll down to the
video.
Most non-trivial systems require dependency tracking between services.
Not only does it help ensure correct operation, it is also an enabler
for starting services in parallel.  Less known, but just as important,
is handling dependencies at system reconfiguration."/>



    <meta property="og:title" content="Dependency handling in Finit" />
<meta property="og:description" content="
This is a blog post about Finit.  Each post is concluded with a video
summarizing the topic.  The impatient reader can scroll down to the
video.
Most non-trivial systems require dependency tracking between services.
Not only does it help ensure correct operation, it is also an enabler
for starting services in parallel.  Less known, but just as important,
is handling dependencies at system reconfiguration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://troglobit.com/post/2022-01-09-dependency-handling-in-finit/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-09T18:46:23+01:00" />
<meta property="article:modified_time" content="2022-01-09T18:46:23+01:00" />







    <meta property="article:published_time" content="2022-01-09 18:46:23 &#43;0100 CET" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://troglobit.com/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://troglobit.com/about/">About</a></li><li><a href="https://troglobit.com/posts/">Blog</a></li><li><a href="https://troglobit.com/howtos/">HowTos</a></li><li><a href="https://troglobit.com/projects/">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://troglobit.com/post/2022-01-09-dependency-handling-in-finit/">Dependency handling in Finit</a>
      </h1>

      

      

      

      <div class="post-content">
        <p><a href="https://troglobit.com/finit.html"><img src="https://troglobit.com/images/finit3.png#floatright" alt="finit logo"></a></p>
<p>This is a blog post about Finit.  Each post is concluded with a video
summarizing the topic.  The impatient reader can scroll down to the
<a href="#video">video</a>.</p>
<p>Most non-trivial systems require dependency tracking between services.
Not only does it help ensure correct operation, it is also an enabler
for starting services in parallel.  Less known, but just as important,
is handling dependencies at system reconfiguration.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Let&#39;s boot up. <a href="https://t.co/AKpDXoh3Vh">pic.twitter.com/AKpDXoh3Vh</a></p>&mdash; ＨＡＣＫＥＲＳＢＯＴ (@Hackers_bot) <a href="https://twitter.com/Hackers_bot/status/1388605672024154114?ref_src=twsrc%5Etfw">May 1, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
<p>Finit handles dependencies between services with a condition subsystem
comprising three major types:</p>
<ul>
<li>pid</li>
<li>net</li>
<li>usr</li>
</ul>
<blockquote>
<p>For more information about the condition subsystem in Finit, see:
<a href="https://github.com/troglobit/finit/blob/master/doc/conditions.md">https://github.com/troglobit/finit/blob/master/doc/conditions.md</a></p>
</blockquote>
<h2 id="pid-conditions">PID Conditions</h2>
<p>A <code>&lt;pid/foo&gt;</code> condition ensures that the service <code>foo</code> has started and
created its PID file in <code>/var/run/foo.pid</code>.  Finit tracks all files
created below <code>/var/run</code> that ends in <code>.pid</code>, or <code>/pid</code> for any
sub-directory.  If the PID in the file matches a service started by
Finit that service&rsquo;s provided condition is asserted.</p>
<blockquote>
<p>At reconfiguration it is expected that services &ldquo;touch&rdquo; their PID
files to reassert the condition they provide.  See the documentation
for details and how to handle non-conformant services.</p>
</blockquote>
<h3 id="example">Example</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/etc/finit.d/foo.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service manual:yes foo -fooargs -- Foo service
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>/etc/finit.d/bar.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service &lt;pid/foo&gt; bar -barargs -- Bar service
</span></span></code></pre></div><p>Bar service is started only when <code>foo</code> is up and ready.</p>
<h2 id="net-conditions">Net Conditions</h2>
<p>A <code>&lt;net/...&gt;</code> condition is for various <em>basic</em> network conditions, e.g.,</p>
<ul>
<li><code>&lt;net/route/default&gt;</code></li>
<li><code>&lt;net/&lt;IFNAME&gt;/exist&gt;</code></li>
<li><code>&lt;net/&lt;IFNAME&gt;/up&gt;</code></li>
<li><code>&lt;net/&lt;IFNAME&gt;/running&gt;</code></li>
</ul>
<h3 id="example-1">Example</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/etc/finit.d/inadyn.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service &lt;net/route/default&gt; inadyn -ns -- In-a-Dyn DDNS Client
</span></span></code></pre></div><p>In-a-Dyn is started only when the system has a default route.  Conversely,
it is stopped (SIGTERM) when the default route is removed.</p>
<h3 id="user-conditions">User Conditions</h3>
<p>A <code>&lt;usr/baz&gt;</code> condition is completely controlled by the user.  These are
<em>static</em> (one-shot) conditions that persist across <code>initctl reload</code>
calls, but do not survive a reboot.</p>
<p>All User conditions are controlled using the <code>initctl cond ..</code> commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>initctl cond set baz   # Set (assert) user-defined condition
</span></span><span style="display:flex;"><span>initctl cond clr baz   # Clear (deassert) user-defined condition
</span></span></code></pre></div><h3 id="example-2">Example</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/etc/finit.d/foo.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service &lt;usr/baz&gt; foo -foargs -- Foo service
</span></span></code></pre></div><p>Foo service is not started until the following command is called:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>initctl cond set baz
</span></span></code></pre></div><h2 id="video">Video</h2>
<p>Here&rsquo;s a video showing conditions in action, booting Alpine Linux
3.13.  The video shows how <code>ntpd</code> depends on <code>syslogd</code>, how this works
and how other conditions can be added.  Worth noting is how dependant
processes are stopped if their dependencies are not satisfied.</p>
<script id="asciicast-460832" src="https://asciinema.org/a/460832.js" async></script>  
<p>Join the <a href="https://github.com/troglobit/finit/discussions/">discussion on GitHub</a> or #troglobit on Freenode if IRC is
more your thing.</p>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://troglobit.com/tags/finit/">finit</a></span>
        <span class="tag"><a href="https://troglobit.com/tags/init/">init</a></span>
        <span class="tag"><a href="https://troglobit.com/tags/opensource/">opensource</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        398 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2022-01-09 18:46
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://troglobit.com/post/2022-01-16-finit-v4.2-released/">
                    <span class="button__icon">←</span>
                    <span class="button__text">Finit v4.2 Released!</span>
                </a>
            </span>
            

            
            <span class="button next">
                <a href="https://troglobit.com/post/2021-05-11-emacs-gmail-and-lore-mailing-lists/">
                    <span class="button__text">Emacs: GMail and Lore Mailing Lists</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2006</span>
            <span><a href="https://troglobit.com/">Joachim Wiberg</a></span>
            <span>UNIX&trade; 4Life! &#9994;</span>
            
            
        </div>
    </div>
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://troglobit.com/bundle.min.46e438bd2eca7eb6358c700b40f6f56b22ab0b92503ecc11a2d8e4bcc610b8b4da83e5ea3d3e84fdb5f3c3c765744b9f5bbaf43cf5a027910be07ee39a9c12a1.js" integrity="sha512-RuQ4vS7KfrY1jHALQPb1ayKrC5JQPswRotjkvMYQuLTag&#43;XqPT6E/bXzw8dldEufW7r0PPWgJ5EL4H7jmpwSoQ=="></script>




    </body>
</html>
