<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.91ae35f985ba4ae6473b8defee39551f3ce6ed2769fdfa9b3df93f2eac0da4bc.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Troglobit - BSD syslogd in Linux</title>
<meta property="og:title" content=Troglobit&#32;-&#32;BSD&#32;syslogd&#32;in&#32;Linux />
<meta name="twitter:title" content=Troglobit&#32;-&#32;BSD&#32;syslogd&#32;in&#32;Linux />
<meta itemprop="name" content=Troglobit&#32;-&#32;BSD&#32;syslogd&#32;in&#32;Linux />
<meta name="application-name" content=Troglobit&#32;-&#32;BSD&#32;syslogd&#32;in&#32;Linux />
<meta property="og:site_name" content="Joachim Wiberg" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/" />
<link rel="canonical" href="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/" itemprop="url" />
<meta name="url" content="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/" />
<meta name="twitter:url" content="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/" />
<meta property="og:url" content="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/" />


<meta property="og:updated_time" content="2019-11-03T23:04:00&#43;01:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://troglobit.com/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="Joachim Wiberg" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.123.7">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.38582ad6358fd7e8681326fd2f2f83c1056c6fa45c4872e09a3760b866676227.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://troglobit.com/">
                <img src="/images/profile.jpg" alt="brand image">
            </a>
        
        
            <a href="https://troglobit.com/">
                <h1>Troglobit</h1>
            </a>
        
    </h1>
    <p class="lead">
    
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Posts</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2025-01-05-testing-network-daemons/">Testing Network Daemons</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/post/2024-08-07-buildroot-development-environment/">Buildroot Development Environment</a>
                            </li>
                        
                    
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/projects/">Projects</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/finit/">Fast init for Linux systems</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/projects/smcroute/">Static Multicast Routing Daemon</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/howtos/">HowTos</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/snmp/">HowTo play with SNMP</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://troglobit.com/howtos/multicast/">Multicast HowTo</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/troglobit">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/joachim-wiberg-3a017125">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>















    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto:Joachim%20Wiberg%20%3ctroglobit&#43;spam@gmail.com%3e">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 Joachim Wiberg. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://troglobit.com/post/2019-11-03-bsd-syslogd-in-linux/">BSD syslogd in Linux</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2019-11-03T23:04:00&#43;0100" class="post-date">
        November 3, 2019
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>5 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-opensource">
        <a href="https://troglobit.com/tags/opensource">opensource</a>
      </li>
      
      <li class="tag-sysklogd">
        <a href="https://troglobit.com/tags/sysklogd">sysklogd</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>Some time ago now I was in a meeting with a customer where I first learned of
the new syslog standard, <a href="https://tools.ietf.org/html/rfc5424" target="_blank">RFC5424</a>.  I say &ldquo;new&rdquo; because, despite it being
ten years old, it was new to me.</p>
<p>Three weeks ago I started updating my fork of <a href="https://www.infodrom.org/projects/sysklogd/" target="_blank">sysklogd</a> to be <a href="https://tools.ietf.org/html/rfc5424" target="_blank">RFC5424</a>
compliant.  I ended up ripping out most of the old code and replacing it with
fresh DNA strands from FreeBSD and NetBSD.</p>
<p>The result is a fully RFC compliant <code>syslogd</code>, <strong>and</strong> a <code>libsyslog</code> with a
replacement <code>syslog.h</code> header for sending RFC5424 events from applications!</p>
<p><a href="https://github.com/troglobit/sysklogd/" target="_blank">https://github.com/troglobit/sysklogd/</a></p>
<p>When I first embarked on this journey I was very surprised to learn that Linux
(GLIBC) did not have an RFC5424 compliant <code>syslog()</code> API.  As it turned out,
neither did FreeBSD.  Only NetBSD had implemented a full stack, from C-library
to syslog daemon.</p>
<p>So the <code>libsyslog</code> and <code>syslog.h</code> replacements included now in sysklogd are
taken from NetBSD, whereas the major parts of the <a href="https://tools.ietf.org/html/rfc3164" target="_blank">RFC3164</a> and <a href="https://tools.ietf.org/html/rfc5424" target="_blank">RFC5424</a>
parsing code in syslogd are taken from FreeBSD.</p>
<h2 id="differences">Differences</h2>
<p>So what are the main differences between the two RFCs?  Well, there are in
fact three different standards at play here.  The first is the original BSD
implementation, which was later sort of standardized in <a href="https://tools.ietf.org/html/rfc3164" target="_blank">RFC3164</a>, this
original BSD is what sysklogd was.</p>
<p>One major difference from the original BSD code and RFC3164, I learned, is
that when sending messages to a remote syslog server, there was no timestamp
or hostname included.  So the receiving syslog server had to look up the host
from the source address in the IP header and then also do the timestamping.
In some respects this is good (and understandable): 1) early on many hosts did
not properly set their hostname, and 2) these same hosts often did not even
have the correct time.</p>
<p>The first job of updating <code>sysklogd</code> was to update it to properly support
RFC3164 formatting of remote syslog messages:</p>
<pre><code>&lt;------- HEADER --------&gt; &lt;----------- MSG ------------&gt;
Aug 24 05:14:15 192.0.2.1 myproc[8710]: Kilroy was here.
 \                \        \      \      \
  \                \        \      \      `-- What you think is the message
   \                \        \      `-------- Convention for process ID (PID)
    \				 \	      `-------------- Convention for process name
	 \                `---------------------- Hostname or IP address
      `-------------------------------------- Notice lack of year ...
</code></pre>
<p>The second part was to add RFC5424 formatting:</p>
<pre><code>&lt;---------------------- HEADER ------------------------&gt;   &lt;---- MSG -----&gt;
2003-08-24T05:14:15.000003-07:00 192.0.2.1 myproc 8710 - - Kilroy was here.
 \                                \         \      \    \ \ \
  \                                \         \      \    \ \ `-- Actual message
   \                                \         \      \    \ `--- Structured data
    \                                \         \      \    `---- Message ID (MsgID)
     \                                \         \      `-------- Process ID (ProcID)
      \                                \         `-------------- Process name (App-Name)
       \                                `----------------------- Hostname or IP address
        `------------------------------------------------------- RFC3339 Timestamp
</code></pre>
<p>Yeah, what about those dashes (<code>-</code>)?  I had to fake it to begin with, because
those dashes, if you disregard the difference in the timestamp, is what are
the major differences between the two RFCs.  As you can see from the figures
above, the RFC3164 world was empty and scary, and the RFC5424 world is full of
confusing stuff??</p>
<p>The first dash above is the new MsgID field, which is a free-form string that
a receiver can use for quick and easy regexp filtering.  The second dash is
<em>structured data</em> and is essentially name-value pairs in a <code>[ .. ]</code> container.
See the RFC for more details and <a href="https://tools.ietf.org/html/rfc5424#section-6.3.5" target="_blank">an example in section
6.3.5</a></p>
<p>To distinguish between the two formats RFC5424 added a version field that
comes right after the <code>&lt;PRI&gt;</code> field, which is at the very start of each syslog
message.  I.e., RFC3164 starts with <code>&lt;PRI&gt;</code> and a space, and RFC5424 starts
with <code>&lt;PRI&gt;1</code> and a space, before the timestamp.</p>
<h2 id="netbsd-api">NetBSD API</h2>
<p>The GLIBC, musl, and uClibc libraries all currently just support RFC3164.  So
there is no way for a Linux application today to add a MsgID or any structured
data to a syslog message &hellip; until now.</p>
<p><code>sysklogd</code> comes with <code>libsyslog</code> and a <code>syslog.h</code> header replacement that
has the NetBSD <code>syslogp()</code> family of APIs:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#fabd2f">int</span>  <span style="color:#fabd2f">setlogmask</span>  (<span style="color:#fabd2f">int</span> maskpri);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">int</span>  <span style="color:#fabd2f">setlogmask_r</span>(<span style="color:#fabd2f">int</span> maskpri, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">openlog</span>   (<span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>ident, <span style="color:#fabd2f">int</span> logopt, <span style="color:#fabd2f">int</span> facility);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">openlog_r</span> (<span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>ident, <span style="color:#fabd2f">int</span> logopt, <span style="color:#fabd2f">int</span> facility, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">closelog</span>  (<span style="color:#fabd2f">void</span>);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">closelog_r</span>(<span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">syslog</span>    (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, ...);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">vsyslog</span>   (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, va_list args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">syslogp</span>   (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>msgid, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>sd, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, ...);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">vsyslogp</span>  (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>msgid, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>sd, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, va_list args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">syslog_r</span>  (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, ...);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">vsyslog_r</span> (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, va_list args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">syslogp_r</span> (<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>msgid, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>sd,
</span></span><span style="display:flex;"><span>                <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, ...);
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">void</span> <span style="color:#fabd2f">vsyslogp_r</span>(<span style="color:#fabd2f">int</span> priority, <span style="color:#fe8019">struct</span> syslog_data <span style="color:#fe8019">*</span>data, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>msgid, <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>sd,
</span></span><span style="display:flex;"><span>                <span style="color:#fe8019">const</span> <span style="color:#fabd2f">char</span> <span style="color:#fe8019">*</span>message, va_list args);
</span></span></code></pre></div><h2 id="example">Example</h2>
<p>To use the new API on Linux we create an example application:</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#928374;font-style:italic">/* example.c - Example of how to use NetBSD syslogp() API */</span>
</span></span><span style="display:flex;"><span><span style="color:#8ec07c">#include</span> <span style="color:#8ec07c;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#8ec07c">
</span></span></span><span style="display:flex;"><span><span style="color:#8ec07c">#include</span> <span style="color:#8ec07c;font-style:italic">&lt;syslog/syslog.h&gt;</span><span style="color:#8ec07c">
</span></span></span><span style="display:flex;"><span><span style="color:#8ec07c"></span>
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">int</span> <span style="color:#fabd2f">main</span>(<span style="color:#fabd2f">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">openlog</span>(<span style="color:#b8bb26">&#34;example&#34;</span>, LOG_PID, LOG_USER);
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">syslogp</span>(LOG_NOTICE, <span style="color:#b8bb26">&#34;MSGID&#34;</span>, <span style="color:#fabd2f">NULL</span>, <span style="color:#b8bb26">&#34;Kilroy was here.&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fabd2f">closelog</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We build and run the application.</p>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jocke@troglobit:~/tmp $ gcc <span style="color:#b8bb26">`</span>pkg-config --libs --static --cflags libsyslog<span style="color:#b8bb26">`</span> <span style="color:#b8bb26">\
</span></span></span><span style="display:flex;"><span><span style="color:#b8bb26"></span>                            -o example example.c
</span></span><span style="display:flex;"><span>jocke@troglobit:~/tmp $ ./example
</span></span></code></pre></div><p>Provided <code>syslogd</code> is set up properly the following would be logged in your
local log file, or sent to a remote syslog server:</p>
<pre><code>2019-11-03T00:46:34.034324+01:00 troglobit example 1234 MSGID - Kilroy was here.
</code></pre>
  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://troglobit.com/post/2019-07-18-controlling-display-brightness/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Controlling Display Brightness</a>
        
	    
            <div class="next-post">
                <a href="https://troglobit.com/post/2020-02-22-useful-unix-apis/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Useful UNIX API:s</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#differences">Differences</a></li>
    <li><a href="#netbsd-api">NetBSD API</a></li>
    <li><a href="#example">Example</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
